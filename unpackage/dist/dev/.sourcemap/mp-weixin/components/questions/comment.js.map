{"version":3,"sources":["webpack:///C:/Users/Administrator/Desktop/项目开发/project1/components/questions/comment.vue?bff0","webpack:///C:/Users/Administrator/Desktop/项目开发/project1/components/questions/comment.vue?b146","webpack:///C:/Users/Administrator/Desktop/项目开发/project1/components/questions/comment.vue?a00f","webpack:///C:/Users/Administrator/Desktop/项目开发/project1/components/questions/comment.vue?1a39","uni-app:///components/questions/comment.vue","webpack:///C:/Users/Administrator/Desktop/项目开发/project1/components/questions/comment.vue?b4a8","webpack:///C:/Users/Administrator/Desktop/项目开发/project1/components/questions/comment.vue?a194"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAoH;AACpH;AAC2D;AACL;AACc;;;AAGpE;AACgL;AAChL,gBAAgB,uLAAU;AAC1B,EAAE,6EAAM;AACR,EAAE,kFAAM;AACR,EAAE,2FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,sFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAqqB,CAAgB,mqBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC4DzrB,uE;AACA;AACA,iBADA;AAEA,kDAFA;AAGA;AACA;AACA,kBADA,EADA,EAHA;;;AAQA,MARA,kBAQA;AACA;AACA,8BADA;AAEA,oBAFA,EAEA;AACA,qBAHA,EAGA;AACA,4BAJA,EAIA;AACA,4BALA,EAKA;AACA,mBANA,EAMA;AACA,oBAPA,EAOA;AACA,iBARA,EAQA;AACA,sBATA,EASA;AACA;AACA,oBADA;AAEA,sBAFA,CAVA;;AAcA,mBAdA,EAcA;AACA,iBAfA,EAeA;AACA,qBAhBA,EAgBA;AACA,kBAjBA,CAiBA;AAjBA;AAmBA,GA5BA;AA6BA,SA7BA,qBA6BA;AACA;AACA;AACA,GAhCA;AAiCA;AACA;AACA,YAFA,sBAEA;AACA;AACA,KAJA;AAKA;AACA,eANA,yBAMA;AACA;AACA,KARA;AASA;AACA,aAVA,uBAUA;AACA;AACA,KAZA;AAaA;AACA,aAdA,uBAcA;AACA;AACA,KAhBA,EAjCA;;AAmDA;AACA;AACA,aAFA,qBAEA,SAFA,EAEA;AACA,mBADA,aACA,YADA,0BACA,SADA;AAEA,qEAFA,SAEA,GAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,iBANA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAjBA;AAkBA,KApBA;AAqBA,aArBA,qBAqBA,OArBA,EAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCATA,CASA;AACA;AACA,KAhCA;AAiCA;AACA,gBAlCA,0BAkCA;AACA;AACA,KApCA;AAqCA;AACA,UAtCA,oBAsCA;AACA;AACA;AACA;AACA;AACA,2BADA;;AAGA,OAJA,MAIA;AACA;AACA;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA,0EADA;AAEA,0CAFA;AAGA,0DAHA;AAIA,6CAJA;AAKA;AACA,iCADA;AAEA,wBAFA,EALA;;;AAUA;AACA,sDADA;AAEA,wBAFA;AAGA,uBAHA;AAIA;AACA;AACA;AACA,uCADA;;AAGA;AACA,kCALA,GAKA;AACA,4FADA;AAEA,8EAFA;AAGA,0DAHA;AAIA,8CAJA;AAKA,iDALA;AAMA,oCANA;AAOA;AACA;AACA,gDAFA;AAGA,oDAHA;AAIA,4DAJA,EAPA,EALA;;;AAmBA,8BAnBA,GAmBA,8BAnBA;AAoBA;AACA;AACA;AACA,kFADA;;AAGA;AACA;AACA;AACA;AACA,yBATA,MASA;AACA;AACA;AACA;AACA;AACA,2BAHA,MAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBA9CA,MA8CA;AACA;AACA,uCADA;;AAGA,uBAnDA,6IAJA;;;;AA2DA;AACA,KA7HA;AA8HA;AACA,SA/HA,iBA+HA,MA/HA,EA+HA;AACA;AACA,mBADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SARA;;AAUA;AACA,KA3IA;AA4IA;AACA,WA7IA,qBA6IA;AACA;AACA,KA/IA;AAgJA;AACA,YAjJA,sBAiJA;AACA;AACA,KAnJA;AAoJA;AACA,YArJA,oBAqJA,KArJA,EAqJA,OArJA,EAqJA;AACA,kDADA;AAEA,0CAFA;AAGA,qDAHA;AAIA,4CAJA;AAKA;AACA,kDADA,IALA;;AAQA,0CARA;AASA;AACA,wCADA;AAEA,oCAFA,GATA,gHASA,QATA,4BASA,QATA;;AAaA,gCAbA;;AAeA;AACA,iIADA;AAEA,oCAFA,GAfA,mHAeA,KAfA,6BAeA,IAfA;;AAmBA;AACA;AACA;AACA;AACA;AACA,yBAJA,GAIA,4DAJA;AAKA;AACA,mBANA,MAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBALA;AAMA;AACA;AACA;AACA;AACA,iCADA;AAEA,mCAFA;;AAIA,iBAtBA,MAsBA;AACA;AACA,iCADA;AAEA,gCAFA;;AAIA,iBA9CA;AA+CA;AACA;AACA,iBAjDA;;AAmDA,KAxMA;AAyMA;AACA,YA1MA,oBA0MA,SA1MA,EA0MA;AACA;AACA;AACA;AAHA,sBAIA,mCAJA;AAKA,mBALA,aAKA,aALA,0BAKA,SALA,cAKA,eALA;AAMA,oFANA,SAMA,KANA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBARA;AASA;AACA,8DAjBA;;AAmBA,qCAnBA;;AAqBA,KA/NA,EAnDA,E;;;;;;;;;;;;;AC7DA;AAAA;AAAA;AAAA;AAA8tC,CAAgB,qpCAAG,EAAC,C;;;;;;;;;;;ACAlvC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"components/questions/comment.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./comment.vue?vue&type=template&id=d4475d1c&\"\nvar renderjs\nimport script from \"./comment.vue?vue&type=script&lang=js&\"\nexport * from \"./comment.vue?vue&type=script&lang=js&\"\nimport style0 from \"./comment.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/questions/comment.vue\"\nexport default component.exports","export * from \"-!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./comment.vue?vue&type=template&id=d4475d1c&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./comment.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./comment.vue?vue&type=script&lang=js&\"","<template>\r\n\t<!--uni-app阻止事件冒泡的方法 -->\r\n\t<view @tap.stop=\"stop\" @longpress.stop=\"stop\">\r\n\t<view class=\"comment\" @tap=\"replyUser(commentData)\" @longpress=\"pupop(commentData.users_model.id)\">\r\n\t\t<view class=\"box-top user\">\r\n\t\t\t<view class=\"icon-head\">\r\n\t\t\t\t<image :src=\"SERVER + commentData.users_model.icon\" />\r\n\t\t\t</view>\r\n\t\t\t<text class=\"phone\">{{username}}</text>\r\n\t\t</view>\r\n\t\t<view class=\"box-center\">\r\n\t\t\t<view class=\"content\" v-if=\"commentData.level\">\r\n\t\t\t\t<text>回复</text>\r\n\t\t\t\t<text class=\"username\">{{'@' + commentData.to_user.username}}</text>\r\n\t\t\t\t<text>{{commentData.content}}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"content\" v-else>{{commentData.content}}</view>\r\n\t\t\t<!-- 没有回复或者回复未展开提交回复时显示 -->\r\n\t\t\t<view class=\"replay_content\" v-show=\"commentData.text && isShow === !countShow\">\r\n\t\t\t\t<text>{{myInfo.username+':'}}</text><text class=\"text\">{{commentData.text}}</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"replayCount\" v-if=\"commentData.replay_models.length > 0 && countShow\" @tap.stop=\"getReplay(commentData.id)\">等{{commentData.replay_models.length}}条回复</view>\r\n\t\t\t<!-- 回复 -->\r\n\t\t\t<view class=\"replay\" v-if=\"children\">\r\n\t\t\t\t<comment v-for=\"comment in commentData.children\" :comment=\"comment\"  :key=\"comment.id\"></comment>\r\n\t\t\t\t<!-- 展开更多回复 -->\r\n\t\t\t\t<view class=\"more\" v-if=\"pageSize < countPage\" @tap.stop=\"showMore(commentData.id)\">展开更多</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"box-bottom\">\r\n\t\t\t<view class=\"date\">{{commentData.date}}</view>\r\n\t\t\t<praise :praiseCount=\"commentData.praise\" :onLikeUrl=\"onLikeUrl\" :isLikeUrl=\"isLikeUrl\"></praise>\r\n\t\t</view>\r\n\t</view>\r\n\t<!-- 弹出回复菜单 -->\n\t<van-popup :show=\"btnShow\" \r\n\t\t@close=\"onPopupClose\"\r\n\t\t@click-overlay=\"onPopupClose\"\r\n\t\tposition=\"bottom\"\r\n\t>\r\n\t\t<view class=\"published\">\r\n\t\t\t<input type=\"text\" ref=\"input\" :placeholder=\"commentPlaceholder\" class=\"input\" v-model=\"content\"/>\r\n\t\t\t<button class=\"btn\" @tap=\"submit\">发送</button>\r\n\t\t</view>\r\n\t</van-popup>\r\n\t<!-- 长按菜单 -->\r\n\t<van-action-sheet\r\n\t  :show=\"popupShow\"\r\n\t  :actions=\"actions\"\r\n\t  cancel-text=\"取消\"\r\n\t  @close=\"onClose\"\r\n\t  @cancel=\"onCancel\"\r\n\t  @select=\"onSelect($event,commentData)\"\r\n\t/>\r\n\t</view>\r\n</template>\n\n<script>\r\n\timport comment from './comment';\r\n\timport praise from './praise';\r\n\timport {renderTime} from '../../static/js/common.js'\r\n\texport default{\r\n\t\tname:'comment',\r\n\t\tcomponents:{praise,comment},\r\n\t\tprops:{\r\n\t\t\tcomment:{\r\n\t\t\t\ttype:Object\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata(){\r\n\t\t\treturn{\r\n\t\t\t\tSERVER:this.development,\r\n\t\t\t\tchildren:null,\t\t\t//回复集合\r\n\t\t\t\tcountShow:true,\t\t\t//显示等多少条回复，默认显示\r\n\t\t\t\tcommentPlaceholder:'',\t//输入框提示值\r\n\t\t\t\treplyUserComment:null,\t//评论对象\r\n\t\t\t\tisShow:false,\t\t\t//标识\r\n\t\t\t\tbtnShow:false,\t\t\t//回复菜单\r\n\t\t\t\tcontent:'',\t\t\t\t//文本框内容\r\n\t\t\t\tpopupShow:false,\t\t//长按菜单\r\n\t\t\t\tactions:[\t\t\t\t//长按菜单菜单项\r\n\t\t\t\t\t{name:'回复'},\r\n\t\t\t\t\t{name:'复制评论'}\r\n\t\t\t\t],\r\n\t\t\t\tisName:false,\t\t\t//标识:actions是否存在{name:'删除'}，默认为不存在\r\n\t\t\t\tpageSize:1,\t\t\t\t//当前分页页码\r\n\t\t\t\tcountPage:null,\t\t\t//后端返回的总页码\r\n\t\t\t\tmyInfo:null\t\t\t\t//当前用户信息\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated(){\r\n\t\t\t// 获取当前用户的信息\r\n\t\t\tthis.myInfo = uni.getStorageSync('user');\r\n\t\t},\r\n\t\tcomputed:{\r\n\t\t\t// 评论的用户名\r\n\t\t\tusername(){\r\n\t\t\t\treturn this.commentData.users ? this.commentData.users.username : this.commentData.users_model.username\r\n\t\t\t},\r\n\t\t\t//新值代替接收父组件传递的comment\r\n\t\t\tcommentData(){\r\n\t\t\t\treturn this.comment\r\n\t\t\t},\r\n\t\t\t// 点赞url\r\n\t\t\tonLikeUrl(){\r\n\t\t\t\treturn this.comment.CommentsModelId ? `${this.SERVER}/api/like?userId=${this.myInfo.id}&replayId=${this.comment.id}` : `${this.SERVER}/api/like?userId=${this.myInfo.id}&commentId=${this.comment.id}`\r\n\t\t\t},\r\n\t\t\t// 点赞状态url\r\n\t\t\tisLikeUrl(){\r\n\t\t\t\treturn this.comment.CommentsModelId ? `${this.SERVER}/api/isLike?userId=${this.myInfo.id}&replayId=${this.comment.id}` : `${this.SERVER}/api/isLike?userId=${this.myInfo.id}&commentId=${this.comment.id}`\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\t// 获取全部回复，参数：评论id\r\n\t\t\tasync getReplay(commentId){\r\n\t\t\t\tlet url = `${this.SERVER}/api/replays/${commentId}`;\r\n\t\t\t\tconst res = await this.pageLoad(url,this.pageSize,this.children);\r\n\t\t\t\tthis.children = res.comments.map(item => {\r\n\t\t\t\t\t// 格式化时间\r\n\t\t\t\t\titem.date = renderTime(item.date)\r\n\t\t\t\t\t// 回复存储答疑id\r\n\t\t\t\t\titem.AnserquestionModelId = this.commentData.AnserquestionModelId\r\n\t\t\t\t\treturn item;\r\n\t\t\t\t});\r\n\t\t\t\t// 将回复挂载到评论上\r\n\t\t\t\tthis.commentData.children = this.children;\r\n\t\t\t\t// 通知父组件更新评论内容\r\n\t\t\t\tthis.$emit('changeCommentContent',this.commentData);\r\n\t\t\t\t// 不显示等多少条回复\r\n\t\t\t\tthis.countShow = false;\r\n\t\t\t\t// 设置分页页码\r\n\t\t\t\tthis.countPage = res.countPage;\r\n\t\t\t},\r\n\t\t\treplyUser(comment){\r\n\t\t\t\t// 调起回复输入框\r\n\t\t\t\tthis.btnShow = true;\r\n\t\t\t\t// 改变输入框提示内容\r\n\t\t\t\tthis.commentPlaceholder = '回复@' + comment.users_model.username;\r\n\t\t\t\t// comment.replay_models存在说明回复评论，不存在说明回复回复信息，index2为区分标识\r\n\t\t\t\tcomment.replay_models ? comment.index2 = 0 : comment.index2 = 1;\r\n\t\t\t\t// comment对象保存当前'等多少条回复'显示状态\r\n\t\t\t\tcomment.countShow = this.countShow;\r\n\t\t\t\tthis.replyUserComment = comment;\t//保存当前评论对象\r\n\t\t\t\tconsole.log('查看to_user',this.replyUserComment)\r\n\t\t\t},\r\n\t\t\t// 关闭弹窗\r\n\t\t\tonPopupClose(){\r\n\t\t\t\tthis.btnShow = false;\r\n\t\t\t},\r\n\t\t\t// 回复评论\r\n\t\t\tsubmit(){\r\n\t\t\t\t// 定义当前时间\r\n\t\t\t\tlet myDate = renderTime(new Date());\r\n\t\t\t\tif (this.content == \"\") {\r\n\t\t\t\t    uni.showToast({\r\n\t\t\t\t\t\ttitle:'输入内容不能为空'\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tlet CommentsModelId;\r\n\t\t\t\t\t// 说明点击的回复\r\n\t\t\t\t\tif(this.replyUserComment.CommentsModelId){\r\n\t\t\t\t\t\tCommentsModelId = this.replyUserComment.CommentsModelId;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t// 说明点击的评论\r\n\t\t\t\t\t\tCommentsModelId = this.replyUserComment.id;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 定义data传递给后端\r\n\t\t\t\t\tlet comment = {\r\n\t\t\t\t\t\tAnserquestionModelId:this.replyUserComment.AnserquestionModelId,\r\n\t\t\t\t\t\tCommentsModelId:CommentsModelId,\r\n\t\t\t\t\t\tto_user_id:this.replyUserComment.users_model.id,\r\n\t\t\t\t\t\tlevel:this.replyUserComment.index2,\r\n\t\t\t\t\t\tdata:{\r\n\t\t\t\t\t\t\tcontent:this.content,\r\n\t\t\t\t\t\t\tdate:myDate\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.request({\r\n\t\t\t\t\t\turl:`${this.SERVER}/api/comments`,\r\n\t\t\t\t\t\tmethod:'post',\r\n\t\t\t\t\t\tdata:comment,\r\n\t\t\t\t\t\tsuccess:async (res) => {\r\n\t\t\t\t\t\t\tif(res.data.code === 0){\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle:'评论成功'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// 前端显示评论信息\r\n\t\t\t\t\t\t\t\tlet newComment = {\r\n\t\t\t\t\t\t\t\t\tAnserquestionModelId:this.replyUserComment.AnserquestionModelId,\r\n\t\t\t\t\t\t\t\t\tUsersModelId:this.replyUserComment.users_model.id,\r\n\t\t\t\t\t\t\t\t\tCommentsModelId:CommentsModelId,\r\n\t\t\t\t\t\t\t\t\tid:res.data.data.id,\r\n\t\t\t\t\t\t\t\t\tcontent:this.content,\r\n\t\t\t\t\t\t\t\t\tdate:'刚刚',\r\n\t\t\t\t\t\t\t\t\tusers_model:{\r\n\t\t\t\t\t\t\t\t\t\t//显示token 的头像和用户名\r\n\t\t\t\t\t\t\t\t\t\tid:this.myInfo.id,\r\n\t\t\t\t\t\t\t\t\t\ticon:this.myInfo.icon,\r\n\t\t\t\t\t\t\t\t\t\tusername:this.myInfo.username\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tlet index2 = this.replyUserComment.index2\r\n\t\t\t\t\t\t\t\tif(index2){\t//回复其他人的回复\r\n\t\t\t\t\t\t\t\t\tnewComment.level = 1;\r\n\t\t\t\t\t\t\t\t\tnewComment.to_user = {\r\n\t\t\t\t\t\t\t\t\t\tusername : this.replyUserComment.users_model.username\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"new\",newComment,this.$parent.children);\r\n\t\t\t\t\t\t\t\t\tthis.$parent.commentData.children.push(newComment);\r\n\t\t\t\t\t\t\t\t\t// 派发更新评论内容\r\n\t\t\t\t\t\t\t\t\tuni.$emit('changeCommentContent',this.$parent.commentData);\r\n\t\t\t\t\t\t\t\t}else{\t//回复评论\r\n\t\t\t\t\t\t\t\t\t// 等多少条回复显示，说明回复内容未展开\r\n\t\t\t\t\t\t\t\t\tif(this.replyUserComment.countShow){\r\n\t\t\t\t\t\t\t\t\t\tthis.commentData.text = this.content;\r\n\t\t\t\t\t\t\t\t\t\tthis.commentData.replay_models.length = this.commentData.replay_models.length ?this.commentData.replay_models.length + 1 : 1;\r\n\t\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\t\t//等多少条回复未显示，说明回复内容已展开\r\n\t\t\t\t\t\t\t\t\t\tthis.commentData.children.unshift(newComment);\r\n\t\t\t\t\t\t\t\t\t\tthis.commentData.replay_models.length = this.commentData.children.length;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// 通知父组件更新评论内容\r\n\t\t\t\t\t\t\t\t\tthis.$emit('changeCommentContent',this.commentData);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthis.content = '';\r\n\t\t\t\t\t\t\t\tthis.btnShow = false;\r\n\t\t\t\t\t\t\t\t// 评论总数 + 1\r\n\t\t\t\t\t\t\t\tthis.$root.question.comment += 1;\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle:'评论失败'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 是否显示删除项\r\n\t\t\tpupop(userId){\r\n\t\t\t\tuni.getStorage({\r\n\t\t\t\t\tkey:'user',\r\n\t\t\t\t\tsuccess:(res) => {\r\n\t\t\t\t\t\t// 评论或回复的用户id等于当前用户id，增加删除项\r\n\t\t\t\t\t\tif(userId === res.data.id && !this.isName){\r\n\t\t\t\t\t\t\tthis.actions.push({name:'删除'});\r\n\t\t\t\t\t\t\tthis.isName = true;\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis.popupShow = true;\r\n\t\t\t},\r\n\t\t\t//关闭选项菜单\r\n\t\t\tonClose(){\r\n\t\t\t\tthis.popupShow = false;\r\n\t\t\t},\r\n\t\t\t// 取消操作\r\n\t\t\tonCancel(){\r\n\t\t\t\tthis.popupShow = false;\r\n\t\t\t},\r\n\t\t\t// 选择选项操作\r\n\t\t\tasync onSelect(event,comment){\r\n\t\t\t\tconsole.log('commentId',comment);\r\n\t\t\t\tif(event.detail.name === '回复'){\r\n\t\t\t\t\tthis.replyUser(this.commentData);\r\n\t\t\t\t}else if(event.detail.name === '复制评论'){\r\n\t\t\t\t\tuni.setClipboardData({\r\n\t\t\t\t\t\tdata:this.commentData.content\r\n\t\t\t\t\t})\r\n\t\t\t\t}else if(event.detail.name === '删除'){\r\n\t\t\t\t\tconst [errModel, resModel] = await uni.showModal({\r\n\t\t\t\t\t\tcontent:\"确定要删除评论吗?\",\r\n\t\t\t\t\t\tshowCancel:true,\r\n\t\t\t\t\t})\r\n\t\t\t\t\tif(resModel.confirm){\r\n\t\t\t\t\t\t// 删除评论或回复\r\n\t\t\t\t\t\tconst [error,res] = await this.request({\r\n\t\t\t\t\t\t\turl:`${this.SERVER}/api/mycomments?comment=${encodeURIComponent(JSON.stringify(comment))}`,\r\n\t\t\t\t\t\t\tmethod:'delete'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tif(res.data.code === 0){\r\n\t\t\t\t\t\t\tif(comment.replay_models){\r\n\t\t\t\t\t\t\t\t// 删除评论\r\n\t\t\t\t\t\t\t\tthis.$emit('deleteComment',comment.id);\r\n\t\t\t\t\t\t\t\t// 评论总数-1\r\n\t\t\t\t\t\t\t\tconst count = comment.replay_models ? comment.replay_models.length + 1 : 1;\r\n\t\t\t\t\t\t\t\tthis.$root.question.comment -= count;\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t// 删除回复\r\n\t\t\t\t\t\t\t\tthis.$parent.commentData.children.forEach((item,index)=>{\r\n\t\t\t\t\t\t\t\t\t// 找到要删除的回复的下标index\r\n\t\t\t\t\t\t\t\t\t if(item.id === comment.id){\r\n\t\t\t\t\t\t\t\t\t\tthis.$parent.commentData.children.splice(index,1);\r\n\t\t\t\t\t\t\t\t\t }\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t// 评论总数-1\r\n\t\t\t\t\t\t\t\tthis.$root.question.comment -= 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle:'删除成功',\r\n\t\t\t\t\t\t\t\ticon:'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle:'删除失败',\r\n\t\t\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else if(res.cancel){\r\n\t\t\t\t\t\tconsole.log('用户点击了取消');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 展开更多\r\n\t\t\tasync showMore(commentId){\r\n\t\t\t\t// 当前页加 1\r\n\t\t\t\tthis.pageSize += 1;\r\n\t\t\t\t// 判断pageSize 是不是最后一页\r\n\t\t\t\tif(this.pageSize <= this.countPage){\r\n\t\t\t\t\tlet url = `${this.SERVER}/api/replays/${commentId}/${this.pageSize}`;\r\n\t\t\t\t\tconst res = await this.pageLoad(url,this.pageSize,this.commentData.children);\r\n\t\t\t\t\tthis.children = res.map(item => {\r\n\t\t\t\t\t\t// 格式化时间\r\n\t\t\t\t\t\tif(item.date !== '刚刚'){\r\n\t\t\t\t\t\t\titem.date = renderTime(item.date)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 回复存储答疑id\r\n\t\t\t\t\t\titem.AnserquestionModelId = this.commentData.AnserquestionModelId\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// 将回复挂载到评论上\r\n\t\t\t\t\tthis.commentData.children = this.children;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.log('没有数据了');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\n</script>\n\n<style lang=\"scss\">\r\n@mixin replayCount(){\r\n\twidth:100%;\r\n\theight:72rpx;\r\n\tline-height:72rpx;\r\n\tbackground:#F7F7E4;\r\n\tcolor:#507daf;\r\n}\r\n.user{\r\n\tpadding-top:40rpx;\r\n\t.icon-head{\r\n\t\twidth:80rpx;\r\n\t\theight:80rpx;\r\n\t\tfloat:left;\r\n\t\timage{\r\n\t\t\twidth:100%;\r\n\t\t\theight:100%;\r\n\t\t\tborder-radius: 100%;\r\n\t\t}\r\n\t}\r\n\t.phone{line-height:80rpx;margin-left:15rpx;color:#888;font-size:20rpx;}\r\n}\r\n.box-center,.box-bottom{\r\n\tmargin-left:95rpx;\r\n\tmargin-right:30rpx;\r\n}\r\n.box-center{\r\n\t.username{\r\n\t\tcolor:#507daf;\r\n\t\tmargin-right:20rpx;\r\n\t}\r\n\t.replayCount{\r\n\t\tmargin-top:10rpx;\r\n\t\t@include replayCount;\r\n\t}\r\n\t.replay_content{\r\n\t\t@include replayCount;\r\n\t\t.text{color:#333;margin-left:20rpx;}\r\n\t}\r\n\t.more{\r\n\t\tcolor:#507daf;\r\n\t}\r\n}\r\n.box-bottom{\r\n\tdisplay:flex;\r\n\tjustify-content: space-between;\r\n\t.btns{\r\n\t\t.praise-btn,.comment-btn{\r\n\t\t\tdisplay:inline-block;\r\n\t\t}\r\n\t}\r\n}\r\n.published{\r\n\twidth:100%;\r\n\theight:80rpx;\r\n\tposition: fixed;\r\n\tleft:0;\r\n\tbottom:0;\r\n\tbackground:#fff;\r\n\tdisplay:flex;\r\n\tjustify-content: space-around;\r\n\tpadding:15rpx 0;\r\n\tbox-sizing: border-box;\r\n\t.input{\r\n\t\twidth:580rpx;\r\n\t\theight:50rpx;\r\n\t\tborder:2rpx solid #ccc;\r\n\t\tborder-radius:10rpx;\r\n\t\tmargin-left:10rpx;\r\n\t\tpadding-left:20rpx;\r\n\t}\r\n\t.btn{\r\n\t\twidth:120rpx;\r\n\t\theight:50rpx;\r\n\t\tbackground:#41A5FD;\r\n\t\tcolor:#fff;\r\n\t\tfont-size:24rpx;\r\n\t\tline-height:50rpx;\r\n\t}\r\n}\n</style>\n","import mod from \"-!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./comment.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Downloads/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./comment.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1614330384162\n      var cssReload = require(\"C:/Users/Administrator/Downloads/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}